<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <title>Stage Speed Gauge - Apache ECharts Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
        }
        #deadLineChart {
            position: relative;
            height:300px;
            overflow: hidden;
        }

    </style>
</head>
<body>
<div id="deadLineChart"></div>
<script src="https://registry.npmmirror.com/echarts/5.5.0/files/dist/echarts.min.js"></script>
<script>
    var dom = document.getElementById('deadLineChart');
    dom.style.width = '654px'; // 设置容器宽度为600px
    dom.style.height = '245px'; // 设置容器高度为400px
    var myChart = echarts.init(dom, null, {
        renderer: 'canvas',
        useDirtyRect: false
    });
    // 使用 AJAX 从服务器获取数据
    fetch('/api/workspace/deadLine') // 假设后端提供了 /api/workspace/deadLine 接口来获取数据
        .then(response => response.json())
        .then(data => {
            // 数据成功获取后，渲染图表
            renderChart(data);
        })
        .catch(error => {
            console.error('Error fetching data:', error);
        });
    function renderChart(data) {
        var countdownMinutes = data.minutes; // 后端数据中包含分钟数
        var countdownSeconds = countdownMinutes * 60;
        var option = {
            series: [
                {
                    type: 'gauge',
                    // 调整仪表盘的外观
                    axisLine: {
                        lineStyle: {
                            width: 20, // 调整轴线的宽度
                            color: [
                                [0.3, '#fd666d'],
                                [0.7, '#37a2da'],
                                [1, '#67e0e3']
                            ]
                        }
                    },
                    // 调整指针样式
                    pointer: {
                        width: 4, // 调整指针的宽度
                        length: '60%' // 调整指针的长度
                    },
                    // 调整刻度线的样式和位置
                    axisTick: {
                        distance: -20, // 调整刻度线与轴线的距离
                        length: 6, // 调整刻度线的长度
                        lineStyle: {
                            color: '#fff', // 调整刻度线的颜色
                            width: 2 // 调整刻度线的宽度
                        }
                    },
                    // 调整分隔线的样式和位置
                    splitLine: {
                        distance: -20, // 调整分隔线与轴线的距离
                        length: 20, // 调整分隔线的长度
                        lineStyle: {
                            color: '#fff', // 调整分隔线的颜色
                            width: 4 // 调整分隔线的宽度
                        }
                    },
                    // 调整轴标签的样式
                    axisLabel: {
                        color: 'inherit',
                        distance: 30, // 调整轴标签与轴线的距离
                        fontSize: 5 // 调整轴标签的字体大小
                    },
                    // 调整详情的样式
                    detail: {
                        fontSize: 12, // 调整详情文字的字体大小
                        formatter: function (value) {
                            // 将剩余秒数转换为分钟和秒的格式
                            var minutes = Math.floor(value / 60);
                            var seconds = value % 60;
                            return minutes + ':' + (seconds < 10 ? '0' + seconds : seconds);
                        },
                        color: 'inherit'
                    },
                    max: countdownSeconds, // 设置仪表盘的最大值为倒计时总时长（秒）
                    // 初始化数据
                    data: [
                        {
                            value: countdownSeconds
                        }
                    ]
                }
            ]
        };
        var timer = setInterval(function () {
            countdownSeconds -= 10;
            myChart.setOption({
                series: [
                    {
                        data: [
                            {
                                value: countdownSeconds
                            }
                        ]
                    }
                ]
            });
            if (countdownSeconds <= 0) {
                clearInterval(timer);
            }
        }, 1000);

        if (option && typeof option === 'object') {
            myChart.setOption(option);
        }

        window.addEventListener('resize', myChart.resize);
    }
</script>
</body>
</html>
