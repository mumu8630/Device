<!DOCTYPE html>
<html  lang="zh" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!--360浏览器优先以webkit内核解析-->
  <title>首页展示</title>
  <link rel="shortcut icon" href="favicon.ico">
  <link href="../static/css/bootstrap.min.css" th:href="@{/css/bootstrap.min.css}" rel="stylesheet"/>
  <link href="../static/css/font-awesome.min.css" th:href="@{/css/font-awesome.min.css}" rel="stylesheet"/>
  <link href="../static/css/style.min.css" th:href="@{/css/style.min.css}" rel="stylesheet"/>
</head>
<!--首页展示页面-->
<body class="gray-bg">
      <div class="ibox-content" >
        <h4>任务列表</h4>
        <p class="small"><i class="fa fa-hand-o-up"></i> 合理的规划 自律的自己</p>
        <div class="input-group">
          <input type="text" id="task" placeholder="添加新任务" class="input input-sm form-control">
          <span class="input-group-btn">
							<button type="button" class="btn btn-sm btn-white" onclick="addTask()"> <i class="fa fa-plus"></i> 添加</button>
          </span>
        </div>
        <ul class="sortable-list connectList agile-list" id="taskList" style="padding: 0px; margin-bottom : 0px">
          <li class="warning-element" th:each="task:${tasks}">
            <span th:text="${task.taskDescription}"></span>
            <div class="agile-detail">
              <a href="javascript:;" class="pull-right btn btn-xs btn-white" th:onclick="'deleteTaskByTestId(' + ${task.taskId} +')'">删除</a>
              <!-- 根据 taskStatus 来设置按钮样式和文字 -->
              <a th:if="${task.taskStatus == '未完成'}" href="javascript:;" class="pull-right btn btn-xs btn-white" th:onclick="'updateTaskStatus('+ ${task.taskId}+')'">去完成</a>
              <a th:if="${task.taskStatus == '已完成'}" href="javascript:;" class="pull-right btn btn-xs btn-primary"  th:onclick="'updateTaskStatus('+ ${task.taskId}+')'">已完成</a>
              <i class="fa fa-clock-o"></i> <span th:text="${#dates.format(task.taskCreateTime, 'yyyy-MM-dd')}"></span>
            </div>
          </li>
        </ul>
      </div>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/bootstrap.min.js}"></script>
<script th:src="@{/js/echarts.min.js}"></script>
<script th:src="@{/ajax/libs/layer/layer.min.js}"></script>
<!--新增任务-->
<script>
  <!--新增任务-->
  let counter = 0;
  function addTask() {
    const taskInput = document.getElementById('task');
    const taskText = taskInput.value.trim();
    if (taskText === '') return;
    const taskList = document.getElementById('taskList');
    const listItem = document.createElement('li');
    // 根据计数器的值切换类名
    const classNames = ['warning-element', 'success-element', 'info-element'];
    const className = classNames[counter % classNames.length];
    listItem.classList.add(className);
    counter++;// 计数器自增
    // 获取当前日期
    const currentDate = new Date();
    const year = currentDate.getFullYear();
    const month = (currentDate.getMonth() + 1).toString().padStart(2, '0');
    const day = currentDate.getDate();
    const dateString = `${year}.${month}.${day}`;
    //Html样式
    listItem.innerHTML = `
                ${taskText}
                <div class="agile-detail">
                <a href="javascript:;" class="pull-right btn btn-xs btn-white" th:onclick="'deleteTaskByTestId(' + ${task.taskId} +')'">删除</a>
				<!-- 根据 taskStatus 来设置按钮样式和文字 -->
    <a th:if="${task.taskStatus == '未完成'}" href="javascript:;" class="pull-right btn btn-xs btn-white" th:onclick="'updateTaskStatus('+ ${task.taskId}+')'">去完成</a>
    <a th:if="${task.taskStatus == '已完成'}" href="javascript:;" class="pull-right btn btn-xs btn-primary"  th:onclick="'updateTaskStatus('+ ${task.taskId}+')'">已完成</a>

    <i class="fa fa-clock-o"></i>${dateString}
    </div>
    `;
    //数据 用于传输至后台 ---> taskController
    const taskData = {
    userId: 1, // 这里可以设置当前登录用户的 ID
    taskDescription: taskText,
    taskDate: currentDate,
    taskStatus: '未完成',
            //	其他属性默认即可 未完成 已经默认时间
    };
            // 发送 AJAX 请求到后端保存任务
    $.ajax({
    url: '/api/addTask', // 后端接收添加任务的接口路径
    type: 'POST',
    contentType: 'application/json',
    data: JSON.stringify(taskData),
    success: function(response) {
            // 在成功保存任务后，刷新页面或者更新任务列表
    window.location.reload(); // 刷新页面
            // 或者更新任务列表的其他逻辑...
    },
    error: function(xhr, status, error) {
            // 处理请求出错的情况
    console.error('请求添加任务时出错：', error);
    }
    });
    taskList.appendChild(listItem);
    taskInput.value = '';

    }
</script>
<!--删除任务的js-->
<script th:inline="javascript">
  function deleteTaskByTestId(taskId) {
    if (confirm('确定删除该任务吗？')) {
      // 发送 AJAX 请求到后端删除任务
      $.ajax({
        url: '/api/deleteTask',
        type: 'POST',
        data: {taskId: taskId},
        success: function(response) {
          // 在成功删除任务后，刷新页面
          window.location.reload();
        },
        error: function(xhr, status, error) {
          // 处理请求出错的情况
          console.error('请求删除任务时出错：', error);
        }
      });
    }
  }
</script>
<!--修改状态-->
<script>
  function updateTaskStatus(taskId) {
    // 确认是否要修改任务状态
    if (confirm('确定修改' + taskId + '号任务状态吗？')) {
      // 发送 AJAX 请求到后端更新任务状态
      $.ajax({
        url: '/api/updateTaskStatus',
        type: 'POST',
        data: {taskId: taskId},
        success: function (response) {
          // 在成功更新任务状态后，刷新页面
          window.location.reload();
        },
        error: function (xhr, status, error) {
          // 处理请求出错的情况
          console.error('请求更新任务状态时出错：', error);
        }
      });
    }
  }
</script>

</body>
</html>
